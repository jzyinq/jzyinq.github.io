"use strict";(self.webpackChunkpiwik_pro=self.webpackChunkpiwik_pro||[]).push([[2116],{27045:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>o});var i=t(85893),s=t(11151);const a={},r="Accelerated Mobile Pages integration",l={id:"integrations/amp-integration",title:"Accelerated Mobile Pages integration",description:"Accelerated Mobile Pages (AMP) is an open",source:"@site/docs/integrations/amp-integration.md",sourceDirName:"integrations",slug:"/integrations/amp-integration",permalink:"/docs/integrations/amp-integration",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/integrations/amp-integration.md",tags:[],version:"current",frontMatter:{},sidebar:"integrationsSideBar",next:{title:"Integrations",permalink:"/docs/integrations/"}},c={},o=[{value:"Basic setup",id:"basic-setup",level:2},{value:"How to get JavaScript Tracking Client cookie hash",id:"how-to-get-javascript-tracking-client-cookie-hash",level:2},{value:"Tracking custom events",id:"tracking-custom-events",level:2},{value:"Tracking download events",id:"tracking-download-events",level:2},{value:"Tracking outlink events",id:"tracking-outlink-events",level:2},{value:"Tracking goal conversions",id:"tracking-goal-conversions",level:2},{value:"Track internal search events",id:"track-internal-search-events",level:2},{value:"Complete page example",id:"complete-page-example",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"accelerated-mobile-pages-integration",children:"Accelerated Mobile Pages integration"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.ampproject.org/",children:"Accelerated Mobile Pages"})," (AMP) is an open\nsource framework designed to optimize browsing on mobile devices. This\ntechnology can render static content pages much faster than traditional\nmethods. To do that AMP removed the possibility of executing JavaScript\non such pages (excluding few approved libraries), so traditional\nanalytic scripts won\u2019t work on such pages. You can still measure user\nengagement using an\n",(0,i.jsx)(n.a,{href:"https://amp.dev/documentation/components/amp-analytics/",children:"amp-analytics"}),"\nlibrary."]}),"\n",(0,i.jsx)(n.h2,{id:"basic-setup",children:"Basic setup"}),"\n",(0,i.jsx)(n.p,{children:"This setup allows you to track page views. Copy following code to your\nAMP page while replacing:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<INSTANCE_DOMAIN>"})," - PPAS instance domain (e.g.\n",(0,i.jsx)(n.code,{children:"analytics.example.com"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<APP_ID>"})," - PPAS application ID (e.g.\n",(0,i.jsx)(n.code,{children:"12345678-1234-1234-1234-1234567890ab"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<TRACKER_HASH>"})," - Cookie hash generated by JavaScript Tracking\nClient. Check ",(0,i.jsx)(n.code,{children:"how to get cookie hash<howToGetJSTCCookieHash>"}),"\nsection for detailed information."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"><\/script>\n<amp-analytics type="ppasanalytics">\n  <script type="application/json">\n  {\n    "vars": {\n      "host": "<INSTANCE_DOMAIN>",\n      "website_id": "<APP_ID>",\n      "website_hash": "<TRACKER_HASH>"\n    }\n  }\n  <\/script>\n</amp-analytics>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"how-to-get-javascript-tracking-client-cookie-hash",children:"How to get JavaScript Tracking Client cookie hash"}),"\n",(0,i.jsx)(n.p,{children:"If there is no non-AMP page tracked by traditional JavaScript Tracking\nClient, this value may be removed from configuration or left empty. It's\nused to guarantee that same cookie will be used by AMP and non-AMP pages\non client domain. This value should be taken from the name of the ID\ncookie generated by JavaScript Tracking Client. Each JavaScript Tracking\nClient generates unique cookie name based on its configuration. Follow\nthese instructions to get hash from cookie generated by JavaScript\nTracking Client:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Setup JavaScript Tracking Client on non-AMP page (if it was not done\nalready)."}),"\n",(0,i.jsx)(n.li,{children:"Open tracked page in the browser."}),"\n",(0,i.jsxs)(n.li,{children:["Open developer tools in the browser and look for cookie starting\nwith ",(0,i.jsx)(n.code,{children:"_pk_id."}),". Cookie name should look similar to this:\n",(0,i.jsx)(n.code,{children:"_pk_id.12345678-1234-1234-1234-1234567890ab.cdef"}),". The part after\nfirst dot is the value of App ID of the cookie (if there are\nmultiple cookies starting with ",(0,i.jsx)(n.code,{children:"_pk_id."})," it may be used to identify\ncorrect cookie). After second dot you'll find the cookie hash\ngenerated by JavaScript Tracking Client (in the example its value is\n",(0,i.jsx)(n.code,{children:"cdef"}),"). Copy this part and replace ",(0,i.jsx)(n.code,{children:"<TRACKER_HASH>"})," with it."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Here you can see how to look for JavaScript Tracking Client cookie in\nGoogle Chrome developer tools:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"image",src:t(65813).Z+"",width:"907",height:"112"})}),"\n",(0,i.jsx)(n.h2,{id:"tracking-custom-events",children:"Tracking custom events"}),"\n",(0,i.jsxs)(n.p,{children:["To track ",(0,i.jsx)(n.code,{children:"custom event<jtc-api-custom-events>"})," you should attach a\ntrigger on the interactive page element and define event values. To do\nthat add to the configuration the\n",(0,i.jsx)(n.a,{href:"https://www.ampproject.org/docs/reference/components/amp-analytics#triggers",children:"triggers"}),"\nsection and set up event trigger."]}),"\n",(0,i.jsx)(n.p,{children:'This example will send custom event when page element using "mybutton"\nID will be clicked:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<amp-analytics type="ppasanalytics">\n  <script type="application/json">\n  {\n    "vars": {\n      "host": <instance_domain>,\n      "website_id": <app_id>,\n      "website_hash": <tracker_hash>\n    },\n    "triggers": {\n      "exampleEvent": {\n        "selector": "#mybutton",\n        "on": "click",\n        "request": "customevent",\n        "vars": {\n          "event_category": "buttons",\n          "event_action": "click",\n          "event_name": "testButton"\n        }\n      }\n    }\n  }\n  <\/script>\n</amp-analytics>\n'})}),"\n",(0,i.jsx)(n.p,{children:"These are parameters used by custom event:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u201c",(0,i.jsx)(n.a,{href:"https://www.ampproject.org/docs/reference/components/amp-analytics#element-selector",children:"selector"}),"\u201d"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CSS selector for element that should be watched"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201con\u201d - HTML event type"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cvars\u201d - Variables that should be used by this event. Custom events\nexpect:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u201cevent_category\u201d - required"}),"\n",(0,i.jsx)(n.li,{children:"\u201cevent_action\u201d - required"}),"\n",(0,i.jsx)(n.li,{children:"\u201cevent_name\u201d - optional"}),"\n",(0,i.jsx)(n.li,{children:"\u201cevent_value\u201d - optional"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"tracking-download-events",children:"Tracking download events"}),"\n",(0,i.jsxs)(n.p,{children:["To track ",(0,i.jsx)(n.code,{children:"download event<jtc-api-download-and-outlink>"})," attach trigger\nto a link in a similar way to ",(0,i.jsx)(n.code,{children:"custom event <ampCustomEvent>"}),"."]}),"\n",(0,i.jsx)(n.p,{children:'This example will send download event when page element using\n"mydownload" ID will be clicked:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<amp-analytics type="ppasanalytics">\n  <script type="application/json">\n  {\n    "vars": {\n      "host": <instance_domain>,\n      "website_id": <app_id>,\n      "website_hash": <tracker_hash>\n    },\n    "triggers": {\n      "exampleEvent": {\n        "selector": "#mydownload",\n        "on": "click",\n        "request": "download",\n        "vars": {\n          "download_url": "https://example.com/whitepaper.pdf"\n        }\n      }\n    }\n  }\n  <\/script>\n</amp-analytics>\n'})}),"\n",(0,i.jsx)(n.p,{children:"These are parameters used by download event:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u201c",(0,i.jsx)(n.a,{href:"https://www.ampproject.org/docs/reference/components/amp-analytics#element-selector",children:"selector"}),"\u201d"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CSS selector for element that should be watched"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201con\u201d - HTML event type"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cvars\u201d - Variables that should be used by this event. Custom events\nexpect:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u201cdownload_url\u201d - required"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"tracking-outlink-events",children:"Tracking outlink events"}),"\n",(0,i.jsxs)(n.p,{children:["To track ",(0,i.jsx)(n.code,{children:"outlink event<jtc-api-download-and-outlink>"})," attach trigger to\na link in a similar way to ",(0,i.jsx)(n.code,{children:"custom event <ampCustomEvent>"}),"."]}),"\n",(0,i.jsx)(n.p,{children:'This example will send outlink event when page element using "myoutlink"\nID will be clicked:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<amp-analytics type="ppasanalytics">\n  <script type="application/json">\n  {\n    "vars": {\n      "host": <instance_domain>,\n      "website_id": <app_id>,\n      "website_hash": <tracker_hash>\n    },\n    "triggers": {\n      "exampleEvent": {\n        "selector": "#myoutlink",\n        "on": "click",\n        "request": "outlink",\n        "vars": {\n          "outlink_url": "https://another-site.com/"\n        }\n      }\n    }\n  }\n  <\/script>\n</amp-analytics>\n'})}),"\n",(0,i.jsx)(n.p,{children:"These are parameters used by outlink event:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u201c",(0,i.jsx)(n.a,{href:"https://www.ampproject.org/docs/reference/components/amp-analytics#element-selector",children:"selector"}),"\u201d"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CSS selector for element that should be watched"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201con\u201d - HTML event type"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cvars\u201d - Variables that should be used by this event. Custom events\nexpect:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u201coutlink_url\u201d - required"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"tracking-goal-conversions",children:"Tracking goal conversions"}),"\n",(0,i.jsxs)(n.p,{children:["To track ",(0,i.jsx)(n.code,{children:"goal conversion<jtc-api-goal-conversions>"})," attach trigger to a\nlink in a similar way to ",(0,i.jsx)(n.code,{children:"custom event <ampCustomEvent>"}),"."]}),"\n",(0,i.jsx)(n.p,{children:'This example will send goal conversion when page element using "mygoal"\nID will be clicked:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<amp-analytics type="ppasanalytics">\n  <script type="application/json">\n  {\n    "vars": {\n      "host": <instance_domain>,\n      "website_id": <app_id>,\n      "website_hash": <tracker_hash>\n    },\n    "triggers": {\n      "exampleEvent": {\n        "selector": "#mygoal",\n        "on": "click",\n        "request": "goal",\n        "vars": {\n          "goal_id": "1",\n          "revenue": "59.99"\n        }\n      }\n    }\n  }\n  <\/script>\n</amp-analytics>\n'})}),"\n",(0,i.jsx)(n.p,{children:"These are parameters used by goal event:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u201c",(0,i.jsx)(n.a,{href:"https://www.ampproject.org/docs/reference/components/amp-analytics#element-selector",children:"selector"}),"\u201d"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CSS selector for element that should be watched"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201con\u201d - HTML event type"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cvars\u201d - Variables that should be used by this event. Custom events\nexpect:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u201cgoal_id\u201d - required"}),"\n",(0,i.jsx)(n.li,{children:'"revenue" - optional'}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"track-internal-search-events",children:"Track internal search events"}),"\n",(0,i.jsxs)(n.p,{children:["To track ",(0,i.jsx)(n.code,{children:"internal search event<jtc-api-site-search>"})," attach trigger to\na link in a similar way to ",(0,i.jsx)(n.code,{children:"custom event <ampCustomEvent>"}),"."]}),"\n",(0,i.jsx)(n.p,{children:'This example will send internal search event when page element using\n"mysearch" ID will be clicked:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<amp-analytics type="ppasanalytics">\n  <script type="application/json">\n  {\n    "vars": {\n      "host": <instance_domain>,\n      "website_id": <app_id>,\n      "website_hash": <tracker_hash>\n    },\n    "triggers": {\n      "exampleEvent": {\n        "selector": "#mysearch",\n        "on": "click",\n        "request": "search",\n        "vars": {\n          "search_keyword": "apple",\n          "search_category": "fruits",\n          "search_result_count": "10",\n        }\n      }\n    }\n  }\n  <\/script>\n</amp-analytics>\n'})}),"\n",(0,i.jsx)(n.p,{children:"These are parameters used by internal search event:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u201c",(0,i.jsx)(n.a,{href:"https://www.ampproject.org/docs/reference/components/amp-analytics#element-selector",children:"selector"}),"\u201d"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CSS selector for element that should be watched"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201con\u201d - HTML event type"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cvars\u201d - Variables that should be used by this event. Custom events\nexpect:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u201csearch_keyword\u201d - required"}),"\n",(0,i.jsx)(n.li,{children:"\u201csearch_category\u201d - required"}),"\n",(0,i.jsx)(n.li,{children:"\u201csearch_result_count\u201d - optional"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"complete-page-example",children:"Complete page example"}),"\n",(0,i.jsx)(n.p,{children:"This example shows complete AMP page with 2 buttons. It will send page\nview, custom event and goal conversion."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<!doctype html>\n<html amp lang="en">\n    <head>\n        <meta charset="utf-8">\n        <title>AMP example page</title>\n        <meta name="viewport" content="width=device-width">\n        <link rel="canonical" href="example.html">\n\n        <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n\n        <script async src="https://cdn.ampproject.org/v0.js"><\/script>\n        <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"><\/script>\n    </head>\n    <body>\n        <amp-analytics type="ppasanalytics">\n            <script type="application/json">\n                {\n                    "vars": {\n                        "host": "example.piwik.pro",\n                        "website_id": "12345678-1234-1234-1234-1234567890ab",\n                        "website_hash": "cdef"\n                    },\n                    "triggers": {\n                        "trackRecommendation": {\n                            "on": "click",\n                            "selector": "#recommend",\n                            "request": "customevent",\n                            "vars": {\n                                "event_category": "social",\n                                "event_action": "recommend",\n                                "event_name": "News letter"\n                            }\n                        },\n                        "trackSubscription": {\n                            "on": "click",\n                            "selector": "#subscribe",\n                            "request": "goal",\n                            "vars": {\n                                "goal_id": "1"\n                            }\n                        }\n                    }\n                }\n            <\/script>\n        </amp-analytics>\n\n        <h1>Welcome</h1>\n        <div>\n            <button id="recommend">Share this page with friends</button>\n        </div>\n        <div>\n            <button id="subscribe">Subscribe to news letter</button>\n        </div>\n    </body>\n</html>\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},65813:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/cookie-hash-5d5bb3eea12f0db3077e4fae0a2f5c20.png"},11151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>r});var i=t(67294);const s={},a=i.createContext(s);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);