"use strict";(self.webpackChunkpiwik_pro=self.webpackChunkpiwik_pro||[]).push([[5452],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1437:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={},i=void 0,l={unversionedId:"data-collection/other_integrations/web_log_analytics",id:"data-collection/other_integrations/web_log_analytics",title:"web_log_analytics",description:"bash",source:"@site/docs/data-collection/other_integrations/web_log_analytics.md",sourceDirName:"data-collection/other_integrations",slug:"/data-collection/other_integrations/web_log_analytics",permalink:"/docs/data-collection/other_integrations/web_log_analytics",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/data-collection/other_integrations/web_log_analytics.md",tags:[],version:"current",frontMatter:{},sidebar:"dataCollectionSideBar",previous:{title:"Progressive Web Applications integration",permalink:"/docs/data-collection/other_integrations/PWA_Integration"},next:{title:"Channel detection",permalink:"/docs/data-collection/processing/channel_detection"}},s={},p=[{value:"Set up log import",id:"set-up-log-import",level:2},{value:"Exclude log lines",id:"exclude-log-lines",level:2},{value:"Add parameters to log import",id:"add-parameters-to-log-import",level:2},{value:"Import data with server log analytics and standard JavaScript simultaneously",id:"import-data-with-server-log-analytics-and-standard-javascript-simultaneously",level:2},{value:"Technical requirements",id:"technical-requirements",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{class:"default-domain"},(0,r.kt)("p",null,"bash")),(0,r.kt)("h1",{id:"web-log-analytics"},"Web Log Analytics"),(0,r.kt)("p",null,"Log analytics is a python script, that allows you to import logs of\ncommon web servers (nginx, apache, iss and more) directly to Piwik PRO.\nIt's a free software available under GPLv3 license, available on\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/PiwikPRO/log-analytics/"},"GitHub")," and\n",(0,r.kt)("a",{parentName:"p",href:"https://pypi.org/project/piwik-pro-log-analytics/"},"PyPi")),(0,r.kt)("p",null,"Installation of the log analytics script -----------------"),(0,r.kt)("p",null,"You can install the script in one of two ways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"By using Python's package manager -",(0,r.kt)("span",{class:"title-ref"},"pip")," - this is the preferred method"),(0,r.kt)("li",{parentName:"ul"},"By downloading the script to your machine manually")),(0,r.kt)("div",{class:"tabs"},(0,r.kt)("div",{class:"group-tab"},(0,r.kt)("p",null,"Python package"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pip install piwik-pro-log-analytics\n"))),(0,r.kt)("div",{class:"group-tab"},(0,r.kt)("p",null,"Python script"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl https://raw.githubusercontent.com/PiwikPRO/log-analytics/master/piwik_pro_log_analytics/import_logs.py > import_logs.py\nchmod +x import_logs.py\n")))),(0,r.kt)("h2",{id:"set-up-log-import"},"Set up log import"),(0,r.kt)("p",null,"You need to run the Log Importer tool with the correct parameters. Some\nof them must be present, while others are optional."),(0,r.kt)("p",null,"Sample command:"),(0,r.kt)("div",{class:"tabs"},(0,r.kt)("div",{class:"group-tab"},(0,r.kt)("p",null,"Python package"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"piwik_pro_log_analytics --url=https://demo.piwik.pro --client-id=*** --client-secret=*** --enable-static --enable-bots --show-progress --idsite=*** --recorders=2 sample.log\n"))),(0,r.kt)("div",{class:"group-tab"},(0,r.kt)("p",null,"Python script"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./import_logs.py --url=https://demo.piwik.pro --client-id=*** --client-secret=*** --enable-static --enable-bots --show-progress --idsite=*** --recorders=2 sample.log\n")))),(0,r.kt)("div",{class:"option"},(0,r.kt)("p",null,"-","-url=",(0,r.kt)("a",{parentName:"p",href:"https://demo.piwik.pro"},"https://demo.piwik.pro")),(0,r.kt)("p",null,"This is a mandatory parameter which points to the location of your Piwik\ninstance")),(0,r.kt)("div",{class:"option"},(0,r.kt)("p",null,"-","-client-id=","*","*","*"),(0,r.kt)("p",null,"Part of API credentials. They can be obtained from PPAS (check ",(0,r.kt)("a",{parentName:"p",href:"https://help.piwik.pro/support/questions/generate-api-credentials/"},"how to\ndo\nit"),").")),(0,r.kt)("div",{class:"option"},(0,r.kt)("p",null,"-","-client-secret=","*","*","*"),(0,r.kt)("p",null,"Part of API credentials. They can be obtained from PPAS (check ",(0,r.kt)("a",{parentName:"p",href:"https://help.piwik.pro/support/questions/generate-api-credentials/"},"how to\ndo\nit"),").")),(0,r.kt)("div",{class:"option"},(0,r.kt)("p",null,"-","-idsite=","*","*","*"),(0,r.kt)("p",null,"Defines the Site ID of the website (eg."),(0,r.kt)("span",{class:"title-ref"},"99e33528-8da4-46d8-be90-a62bfb3a7bba"),")."),(0,r.kt)("p",null,"There are many other options that can be added to this script, which are\ndescribed in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Tracker-log-import-add-parameters-to-log-import"),"."),(0,r.kt)("p",null,"If you plan to import logs on a regular basis it is advised to setup a\nscheduled job using a tool such as CRON."),(0,r.kt)("h2",{id:"exclude-log-lines"},"Exclude log lines"),(0,r.kt)("p",null,"There are several methods allowing you to exclude particular log lines\nor visitors from being tracked:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You can exclude specific IP addresses or IP ranges from being\ntracked. To configure excluded IPs, log into Piwik as a superuser,\nthen click Administration ",">"," Websites."),(0,r.kt)("li",{parentName:"ul"},"Excluding lines from specific IP or IP ranges - this can be done the\nsame way as in the default tracking method in Piwik (by adding an\nexcluded IP or IP range in the Administration -",">"," Websites menu)"),(0,r.kt)("li",{parentName:"ul"},"You can exclude visitors based on their User Agent HTTP headers by\nusing ",(0,r.kt)("strong",{parentName:"li"},"--useragent-exclude")),(0,r.kt)("li",{parentName:"ul"},"You can also provide a sole hostname that you would like to import\nfrom. This means that all the logs from other hosts will be ignored.\nThe parameter allowing this is: ",(0,r.kt)("strong",{parentName:"li"},"--hostname")),(0,r.kt)("li",{parentName:"ul"},"It is also possible to exclude specific log lines where the URL path\nmatches a particular URL path. See the option ",(0,r.kt)("strong",{parentName:"li"},"--exclude-path"))),(0,r.kt)("p",null,"If you need to add multiple paths or hostnames, you will need to add\nthese parameters multiple times."),(0,r.kt)("h2",{id:"add-parameters-to-log-import"},"Add parameters to log import"),(0,r.kt)("p",null,"The Web Log Analytics script does not track static files (JS, CSS,\nimages, etc.). It also excludes all bot traffic."),(0,r.kt)("p",null,"Use the following commands to enable tracking of these elements:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"--enable-bots")," This enables tracking of search/spam bots via\nPiwik. Just add a custom variable with the bot\u2019s name. The\nUser-agent field is examined to determine whether a log line comes\nfrom a bot or a real user."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"--enable-static")," Specifies tracking of all static files (images,\nJS, CSS) in Piwik PRO."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"--enable-http-redirects")," This tracks HTTP redirects as page\nviews, with a custom title and custom variable."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"--enable-reverse-dns")," Activates reverse DNS, which is used in\ngenerating the Visitors ",">"," Providers report. NOTE: this may lead to\na serious drop in performance as reverse DNS is very slow."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"--recorders=N")," Sets a specific number of threads. We recommend\nmatching it to the number of CPU cores in the system."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"--enable-bulk-tracking")," Enables bulk tracking mode. Tracking\nrequests will be bunched up and send using bulk request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"--recorder-max-payload-size=N")," When importer uses the Piwik PRO\nbulk tracking feature in order to boost speed (option\n",(0,r.kt)("strong",{parentName:"li"},"--enable-bulk-tracking"),"), this option configures max number of\ntracking requests that bulk request can contain. Adjust the number\nof pageviews (or log lines) to see what generates the best\nperformance.")),(0,r.kt)("p",null,"More information about log import parameters can be found using the help\nparameter:"),(0,r.kt)("div",{class:"tabs"},(0,r.kt)("div",{class:"group-tab"},(0,r.kt)("p",null,"Python package"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"piwik_pro_log_analytics --help\n"))),(0,r.kt)("div",{class:"group-tab"},(0,r.kt)("p",null,"Python script"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./import_logs.py --help\n")))),(0,r.kt)("h2",{id:"import-data-with-server-log-analytics-and-standard-javascript-simultaneously"},"Import data with server log analytics and standard JavaScript simultaneously"),(0,r.kt)("p",null,"JavaScript Tracking Client and web server log file analytics can be used\nat the same time, on the condition that data is recorded for each method\nin a separate Piwik PRO website."),(0,r.kt)("p",null,"To avoid double counts of visits, follow these steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a new website in Piwik PRO with a name, for example,\nexample.com (log files)."),(0,r.kt)("li",{parentName:"ol"},"Record the website ID of this new website. The website ID will be\nused for importing log file data."),(0,r.kt)("li",{parentName:"ol"},"In the command line, force all requests from log files to be\nrecorded in a specific website ID via the command --idsite=X.")),(0,r.kt)("h2",{id:"technical-requirements"},"Technical requirements"),(0,r.kt)("p",null,"Technical requirements for running Web Log Analytics:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Access to the server or server logs - for example via SSH"),(0,r.kt)("li",{parentName:"ul"},"Python 3.6+ - older versions (e.g. 2.6, 2.7 or 3.5) are not\nsupported. Most often you'll want to import your data straight from\nthe server where it is created. To do this, you\u2019ll need to be able\nto run a Python script on the machine that will send the logs to\nPiwik PRO."),(0,r.kt)("li",{parentName:"ul"},"Log Analytics script - this is a script written in Python ensuring\nthat logs are sent to your Piwik PRO instance, available on\n",(0,r.kt)("a",{parentName:"li",href:"https://github.com/PiwikPRO/log-analytics/"},"GitHub"))),(0,r.kt)("p",null,"Supported log formats:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"all default log formats for: Nginx, Apache, IIS, Tomcat"),(0,r.kt)("li",{parentName:"ul"},"all common log formats like: NCSA Common log format, Extended log\nformat, W3C Extended log files, Nginx JSON"),(0,r.kt)("li",{parentName:"ul"},"log files of some popular Cloud Saas services: Amazon CloudFront\nlogs, Amazon S3 logs"),(0,r.kt)("li",{parentName:"ul"},"streaming media server log files such as: Icecast"),(0,r.kt)("li",{parentName:"ul"},"log files with and without the virtual host will be imported")),(0,r.kt)("p",null,"This script does not directly support importing logs from log\naggregation tools, like Grafana Loki or ELK. If you'd like to import\nlogs from one of those, you need to download them to the disk first."),(0,r.kt)("p",null,"Performance considerations & rate limiting ----------------------"),(0,r.kt)("p",null,"The script needs CPU to read and parse the log files, but it is usually\nPiwik PRO server itself which will limit the import speed due to network\nlatency. To improve performance, you can use the ",(0,r.kt)("strong",{parentName:"p"},"--recorders")," option\nto specify the number of parallel threads which will import hits into\nPiwik PRO. By default we are using one recorder, but you can increase\nthis value until you achieve satisfying speed."),(0,r.kt)("p",null,"If you are Piwik PRO Core user, please make sure, that you are not\nhitting rate limits, by using ",(0,r.kt)("strong",{parentName:"p"},"--sleep-between-requests-ms")," flag to\nslow down the import process."))}d.isMDXComponent=!0}}]);